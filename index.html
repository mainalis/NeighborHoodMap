<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>NeighborHood Map</title>
    <style type="text/css">
        html,body, #map-canvas { height: 90%; margin: 5px; padding: 5px;}
    </style>
    <link rel="stylesheet" href="css/main.css">
    <!--
    <script type="text/javascript"
        src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyDDDVyS1F8kz4gk_tpIzMf4z_QGVxixBag">

    </script>
    -->

    <script type="text/javascript">
        var map;
        var service;
        var infoWindow;
        var latLng ;
        var searchBox;
        function initialize() {

            console.log(" initialize is called");
            latLng = new google.maps.LatLng(27.717245, 85.323961);
            infoWindow = new google.maps.InfoWindow();
            var mapOptions = {
                center: latLng,
                zoom: 16,
                backgroundColor: "#ff0000"
            };

            var drag = function() {
                console.log(" Drag is detected");
            };

           // searchBox
            var input = document.getElementById("pc-input")
            searchBox = new goole.maps.places.SearchBox(input);

            map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

            map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);
            var marker = new google.maps.Marker({
                position: latLng,
                title: 'Point A',
                label: "SUSHIL MAINALI",
                map: map,
                draggable: true
            });
            var request = {
                location: latLng,
                radius: '1000',
                types: ["restaurant","store"] // restaurant
            };

            service = new google.maps.places.PlacesService(map);
            service.nearbySearch(request, callback);
            // text search

            // service.textSearch(request, callback);

            google.maps.event.addListener(map, 'dragend', function(){ alert('map dragged');});
            console.log(" Get center "+ JSON.stringify(map.getDiv()));

        }

        function callback(results, status) {
            if(status == google.maps.places.PlacesServiceStatus.OK) {
                for (var i = 0; i < results.length; i++) {
                    var place = results[i];
                    console.log(" result "+ i+ " "+ JSON.stringify(place));
                    createMarker(results[i]);
                }
            }
        };

        function createMarker(place) {
            var placeLoc = place.geometry.location;
            var marker = new google.maps.Marker({
                map: map,
                position: place.geometry.location
            });

            google.maps.event.addListener(marker, 'click', function() {
                infoWindow.setContent(place.name);
                infoWindow.open(map, this);
            });
        };
        //google.maps.event.addDomListener(window, 'load', initialize);


    </script>
</head>
    <input id="pac-input" class="controls" type="text" placeholder="Search entry"/>
    <div id="map-canvas"></div>
<script type="text/javascript"
        src = "https://maps.googleapis.com/maps/api/js?signed_in=true&libraries=places&callback=initialize" async defer></script>
<body>

</body>
</html>